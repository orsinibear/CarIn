(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[319],{60319:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return O}});var r=n(57437),o=n(2265),l=n(30166),a=n(16226),s=n(22538),i=n(81080),c=n(60759);let u=(0,a.dW)(function({position:e,...t},n){let r=new c.Marker(e,t);return(0,s.O)(r,(0,i.sj)(n,{overlayContainer:r}))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())}),d=(0,a.SO)(function(e,t){let n=new c.Popup(e,t.overlayContainer);return(0,s.O)(n,t)},function(e,t,{position:n},r){(0,o.useEffect)(function(){let{instance:o}=e;function l(e){e.popup===o&&(o.update(),r(!0))}function a(e){e.popup===o&&r(!1)}return t.map.on({popupopen:l,popupclose:a}),null==t.overlayContainer?(null!=n&&o.setLatLng(n),o.openOn(t.map)):t.overlayContainer.bindPopup(o),function(){t.map.off({popupopen:l,popupclose:a}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(o)}},[e,t,r,n])});var f=n(27648);function m(e){let{spot:t}=e;return(0,r.jsxs)("div",{className:"spot-info-window p-3 min-w-[250px]",children:[(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsxs)("h3",{className:"font-semibold text-lg text-gray-900 mb-1",children:["Spot #",t.id]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 truncate",children:t.location})]}),t.description&&(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-2 line-clamp-2",children:t.description}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-xl font-bold text-blue-600",children:t.pricePerHour}),(0,r.jsx)("span",{className:"text-gray-500 text-sm ml-1",children:"cUSD/hr"})]}),(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(t.isAvailable?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.isAvailable?"Available":"Unavailable"})]}),(0,r.jsx)(f.default,{href:"/booking/".concat(t.id),className:"block w-full text-center bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors text-sm font-medium",children:"View Details"})]})}let p=e=>(0,c.divIcon)({html:'\n    <svg width="32" height="40" viewBox="0 0 32 40" xmlns="http://www.w3.org/2000/svg">\n      <path d="M16 0C10.5 0 6 4.5 6 10c0 6 10 18 10 18s10-12 10-18c0-5.5-4.5-10-10-10z" fill="'.concat(e?"#10b981":"#ef4444",'" stroke="white" stroke-width="2"/>\n      <circle cx="16" cy="10" r="4" fill="white"/>\n    </svg>\n  '),className:"custom-marker",iconSize:[32,40],iconAnchor:[16,40],popupAnchor:[0,-40]});function h(e){let{spot:t,onClick:n}=e;if(!t.coordinates)return null;let o=[t.coordinates.lat,t.coordinates.lng],l=p(t.isAvailable);return(0,r.jsx)(u,{position:o,icon:l,eventHandlers:{click:()=>{null==n||n(t)}},children:(0,r.jsx)(d,{maxWidth:300,className:"spot-popup",children:(0,r.jsx)(m,{spot:t})})})}var x=n(29264);async function g(e){return"google"===x.Bn.provider&&x.Bn.googleMapsApiKey?b(e):v(e)}async function v(e){try{let t="https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(e),"&limit=1"),n=await fetch(t,{headers:{"User-Agent":"CarIn-Parking-App"}});if(!n.ok)throw Error("Geocoding service unavailable");let r=await n.json();if(!r||0===r.length)throw Error("Address not found");let o=r[0];return{address:o.display_name,coordinates:{lat:parseFloat(o.lat),lng:parseFloat(o.lon)}}}catch(e){throw{message:e.message||"Failed to geocode address",code:"GEOCODE_ERROR"}}}async function b(e){try{let t="https://maps.googleapis.com/maps/api/geocode/json?address=".concat(encodeURIComponent(e),"&key=").concat(x.Bn.googleMapsApiKey),n=await fetch(t);if(!n.ok)throw Error("Google Geocoding API unavailable");let r=await n.json();if("OK"!==r.status||!r.results||0===r.results.length)throw Error("Address not found");let o=r.results[0],l=o.geometry.location;return{address:o.formatted_address,coordinates:{lat:l.lat,lng:l.lng}}}catch(e){throw{message:e.message||"Failed to geocode address",code:"GEOCODE_ERROR"}}}function y(e){let{onLocationFound:t,onError:n,placeholder:l="Search for an address or location..."}=e,[a,s]=(0,o.useState)(""),[i,c]=(0,o.useState)(!1),u=(0,o.useRef)(null),d=(0,o.useCallback)(async e=>{if(e.trim()){c(!0);try{let n=await g(e);t(n.coordinates,n.address),s(n.address)}catch(t){let e=t.message||"Failed to find location";null==n||n(e)}finally{c(!1)}}},[t,n]);return(0,r.jsx)("form",{onSubmit:e=>{e.preventDefault(),u.current&&clearTimeout(u.current),d(a)},className:"w-full",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",value:a,onChange:e=>{let t=e.target.value;s(t),u.current&&clearTimeout(u.current),t.trim().length>=3&&(u.current=setTimeout(()=>{d(t)},500))},placeholder:l,className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:i}),(0,r.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:i?(0,r.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}):(0,r.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})})}function j(e){var t,n,l,a;let{onFilterChange:s,defaultFilters:i}=e,[c,u]=(0,o.useState)({minPrice:null!==(t=null==i?void 0:i.minPrice)&&void 0!==t?t:0,maxPrice:null!==(n=null==i?void 0:i.maxPrice)&&void 0!==n?n:10,showAvailableOnly:null!==(l=null==i?void 0:i.showAvailableOnly)&&void 0!==l&&l,maxDistance:null!==(a=null==i?void 0:i.maxDistance)&&void 0!==a?a:50}),[d,f]=(0,o.useState)(!1),m=(e,t)=>{let n={...c,[e]:t};u(n),s(n)};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[(0,r.jsxs)("button",{onClick:()=>f(!d),className:"w-full flex items-center justify-between text-left",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Filters"}),(0,r.jsx)("svg",{className:"w-5 h-5 transition-transform ".concat(d?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),d&&(0,r.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price Range (cUSD/hr)"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"number",min:"0",step:"0.1",value:c.minPrice,onChange:e=>m("minPrice",parseFloat(e.target.value)||0),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Min"}),(0,r.jsx)("span",{className:"text-gray-500",children:"-"}),(0,r.jsx)("input",{type:"number",min:"0",step:"0.1",value:c.maxPrice,onChange:e=>m("maxPrice",parseFloat(e.target.value)||10),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Max"})]})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:c.showAvailableOnly,onChange:e=>m("showAvailableOnly",e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Show available spots only"})]})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Max Distance: ",c.maxDistance," km"]}),(0,r.jsx)("input",{type:"range",min:"1",max:"100",value:c.maxDistance,onChange:e=>m("maxDistance",parseInt(e.target.value)),className:"w-full"})]})]})]})}var w=n(32679),N=n(96567);function k(e){let{onCenterChange:t}=e,n=(0,w.Sx)(),{location:o,getCurrentPosition:l}=(0,N.Z)();return(0,r.jsxs)("div",{className:"absolute top-4 right-4 z-[1000] flex flex-col gap-2",children:[(0,r.jsx)("button",{onClick:()=>{o?(n.setView([o.lat,o.lng],15),null==t||t(o)):l()},className:"bg-white p-2 rounded-lg shadow-lg hover:bg-gray-50 transition-colors",title:"Center on my location",children:(0,r.jsxs)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,r.jsxs)("div",{className:"flex flex-col bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,r.jsx)("button",{onClick:()=>{n.zoomIn()},className:"p-2 hover:bg-gray-50 transition-colors border-b border-gray-200",title:"Zoom in",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(0,r.jsx)("button",{onClick:()=>{n.zoomOut()},className:"p-2 hover:bg-gray-50 transition-colors",title:"Zoom out",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})})]}),(0,r.jsx)("button",{onClick:()=>{var e,t,r;let o=n.getContainer();document.fullscreenElement?null===(t=(r=document).exitFullscreen)||void 0===t||t.call(r):null===(e=o.requestFullscreen)||void 0===e||e.call(o)},className:"bg-white p-2 rounded-lg shadow-lg hover:bg-gray-50 transition-colors",title:"Toggle fullscreen",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})}var C=n(97130),E=n(43781);let L=(0,l.default)(()=>Promise.all([n.e(5641),n.e(2241)]).then(n.bind(n,62241)),{loadableGenerated:{webpack:()=>[62241]},ssr:!1,loading:()=>(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading map..."})]})})});function O(e){let{onSpotClick:t}=e,{spots:n,loading:l,error:a,refresh:s}=(0,C.j)(),{location:i}=(0,N.Z)(),{getAvailability:c}=function(e){let[t,n]=(0,o.useState)(new Map),r=(0,o.useCallback)(async e=>{try{await new Promise(e=>setTimeout(e,500));let t=Math.random()>.3;n(n=>{let r=new Map(n);return r.set(e,{spotId:e,isAvailable:t,lastChecked:Date.now()}),r})}catch(t){console.error("Failed to check availability for spot ".concat(e,":"),t)}},[]),l=(0,o.useCallback)(async()=>{await Promise.all(e.map(e=>r(e.id)))},[e,r]);(0,o.useEffect)(()=>{l();let e=setInterval(()=>{l()},3e4);return()=>clearInterval(e)},[l]);let a=(0,o.useCallback)(e=>{let n=t.get(e);return n?n.isAvailable:null},[t]);return{availabilityMap:t,getAvailability:a,refreshAvailability:l}}(n),[u,d]=(0,o.useState)(i||x.Bn.defaultCenter),[f,m]=(0,o.useState)({minPrice:0,maxPrice:10,showAvailableOnly:!1,maxDistance:50});(0,o.useEffect)(()=>{i&&d(i)},[i]);let p=(0,o.useMemo)(()=>n.filter(e=>{let t=parseFloat(e.pricePerHour);return!(t<f.minPrice||t>f.maxPrice||f.showAvailableOnly&&!e.isAvailable||i&&e.coordinates&&(0,E.cL)(i,e.coordinates)>f.maxDistance)}),[n,f,i]),g=(0,o.useCallback)((e,t)=>{d(e)},[]),v=(0,o.useCallback)(e=>{m(e)},[]);return l&&0===n.length?(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading parking spots..."})]})}):a?(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,r.jsxs)("div",{className:"text-center p-6 bg-white rounded-lg shadow",children:[(0,r.jsxs)("p",{className:"text-red-600 mb-4",children:["Error loading spots: ",a]}),(0,r.jsx)("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Retry"})]})}):(0,r.jsxs)("div",{className:"relative w-full h-full",children:[(0,r.jsx)("div",{className:"absolute top-4 left-4 right-4 md:right-auto md:w-80 z-[1000]",children:(0,r.jsx)(y,{onLocationFound:g})}),(0,r.jsx)("div",{className:"absolute top-20 md:top-4 md:left-[340px] left-4 right-4 md:right-auto md:w-64 z-[1000]",children:(0,r.jsx)(j,{onFilterChange:v})}),(0,r.jsx)("div",{className:"w-full h-full min-h-[500px] md:min-h-[600px]",children:(0,r.jsxs)(L,{center:u,children:[(0,r.jsx)(k,{onCenterChange:d}),p.filter(e=>e.coordinates).map(e=>(0,r.jsx)(h,{spot:e,onClick:t},e.id))]})}),(0,r.jsx)("div",{className:"absolute bottom-4 left-4 z-[1000] bg-white px-4 py-2 rounded-lg shadow-lg",children:(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Showing ",(0,r.jsx)("span",{className:"font-semibold",children:p.length})," ","of ",(0,r.jsx)("span",{className:"font-semibold",children:n.length})," spots"]})})]})}},29264:function(e,t,n){"use strict";n.d(t,{Bn:function(){return o}});var r=n(40257);let o={provider:r.env.NEXT_PUBLIC_MAP_PROVIDER||"leaflet",googleMapsApiKey:r.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY,defaultCenter:{lat:37.7749,lng:-122.4194},defaultZoom:13,maxZoom:18,minZoom:10}},40257:function(e,t,n){"use strict";var r,o;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(44227)},44227:function(e){!function(){var t={229:function(e){var t,n,r,o=e.exports={};function l(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var i=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?i=r.concat(i):u=-1,i.length&&f())}function f(){if(!c){var e=s(d);c=!0;for(var t=i.length;t;){for(r=i,i=[];++u<t;)r&&r[u].run();u=-1,t=i.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];i.push(new m(e,t)),1!==i.length||c||s(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=p,o.addListener=p,o.once=p,o.off=p,o.removeListener=p,o.removeAllListeners=p,o.emit=p,o.prependListener=p,o.prependOnceListener=p,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var l=n[e]={exports:{}},a=!0;try{t[e](l,l.exports,r),a=!1}finally{a&&delete n[e]}return l.exports}r.ab="//";var o=r(229);e.exports=o}()},81080:function(e,t,n){"use strict";n.d(t,{Hb:function(){return o},UO:function(){return s},mE:function(){return i},sj:function(){return l}});var r=n(2265);function o(e){return Object.freeze({__version:1,map:e})}function l(e,t){return Object.freeze({...e,...t})}let a=(0,r.createContext)(null),s=a.Provider;function i(){let e=(0,r.useContext)(a);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}},22538:function(e,t,n){"use strict";n.d(t,{I:function(){return l},O:function(){return o}});var r=n(2265);function o(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function l(e,t){return null==t?function(t,n){let o=(0,r.useRef)();return o.current||(o.current=e(t,n)),o}:function(n,o){let l=(0,r.useRef)();l.current||(l.current=e(n,o));let a=(0,r.useRef)(n),{instance:s}=l.current;return(0,r.useEffect)(function(){a.current!==n&&(t(s,n,a.current),a.current=n)},[s,n,o]),l}}},16226:function(e,t,n){"use strict";n.d(t,{dW:function(){return d},SO:function(){return f},Lf:function(){return m}});var r=n(2265),o=n(54887),l=n(81080),a=n(22538);function s(e,t){let n=(0,r.useRef)(t);(0,r.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function i(e,t){let n=(0,r.useRef)();(0,r.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}var c=n(38651);function u(e){return function(t){var n;let o=(0,l.mE)(),a=e((0,c.q)(t,o),o);return s(o.map,t.attribution),i(a.current,t.eventHandlers),n=a.current,(0,r.useEffect)(function(){return(o.layerContainer??o.map).addLayer(n.instance),function(){o.layerContainer?.removeLayer(n.instance),o.map.removeLayer(n.instance)}},[o,n]),a}}function d(e,t){var n;return n=u((0,a.I)(e,t)),(0,r.forwardRef)(function(e,t){let{instance:o,context:a}=n(e).current;return(0,r.useImperativeHandle)(t,()=>o),null==e.children?null:r.createElement(l.UO,{value:a},e.children)})}function f(e,t){var n,u;return n=(0,a.I)(e),u=function(e,r){let o=(0,l.mE)(),a=n((0,c.q)(e,o),o);return s(o.map,e.attribution),i(a.current,e.eventHandlers),t(a.current,o,e,r),a},(0,r.forwardRef)(function(e,t){let[n,l]=(0,r.useState)(!1),{instance:a}=u(e,l).current;(0,r.useImperativeHandle)(t,()=>a),(0,r.useEffect)(function(){n&&a.update()},[a,n,e.children]);let s=a._contentNode;return s?(0,o.createPortal)(e.children,s):null})}function m(e,t){var n;return n=u((0,a.I)(e,t)),(0,r.forwardRef)(function(e,t){let{instance:o}=n(e).current;return(0,r.useImperativeHandle)(t,()=>o),null})}},38651:function(e,t,n){"use strict";function r(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}n.d(t,{q:function(){return r}})},32679:function(e,t,n){"use strict";n.d(t,{Sx:function(){return o}});var r=n(81080);function o(){return(0,r.mE)().map}n(2265)}}]);