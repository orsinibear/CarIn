(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5926],{82506:function(e,t,s){Promise.resolve().then(s.bind(s,498))},498:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var n=s(57437),a=s(2265),r=s(45562),i=s(72081);function l(e){let{booking:t}=e,[s,r]=(0,a.useState)(!1);return(0,n.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-shadow",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:t.spotLocation}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["Booking #",t.id.slice(-8)]})]}),(0,n.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat((e=>{switch(e){case"confirmed":case"active":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-blue-100 text-blue-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(t.status)),children:t.status})]}),(0,n.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Date:"}),(0,n.jsx)("span",{className:"font-medium",children:new Date(t.date).toLocaleDateString()})]}),(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Time:"}),(0,n.jsxs)("span",{className:"font-medium",children:[t.startTime," - ",t.endTime]})]}),(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Cost:"}),(0,n.jsxs)("span",{className:"font-medium text-blue-600",children:[t.totalCost," cUSD"]})]}),t.transactionHash&&(0,n.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,n.jsx)("span",{className:"text-gray-500",children:"TX:"}),(0,n.jsxs)("span",{className:"font-mono text-gray-500",children:[t.transactionHash.slice(0,10),"..."]})]})]}),(0,n.jsxs)("div",{className:"flex gap-2 pt-4 border-t",children:[(0,n.jsxs)("button",{onClick:()=>r(!s),className:"flex-1 px-4 py-2 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:[s?"Hide":"Show"," QR Code"]}),(0,n.jsx)("button",{onClick:()=>window.location.href="/booking/".concat(t.spotId),className:"px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"View Details"})]}),s&&(0,n.jsx)("div",{className:"mt-4 pt-4 border-t text-center",children:(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)(i.Z,{bookingId:t.id,spotId:t.spotId,spotLocation:t.spotLocation,signature:t.signature,signerAddress:t.signerAddress,timestamp:new Date(t.date).getTime()})})})]})}function o(e){let{filter:t,onFilterChange:s,searchQuery:a,onSearchChange:r}=e;return(0,n.jsx)("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:(0,n.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)("input",{type:"text",placeholder:"Search bookings...",value:a,onChange:e=>r(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})}),(0,n.jsx)("div",{className:"flex gap-2",children:["all","pending","active","completed"].map(e=>(0,n.jsx)("button",{onClick:()=>s(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(t===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})})}function c(e){let{userAddress:t}=e,[s,r]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)("all"),[x,m]=(0,a.useState)("");(0,a.useEffect)(()=>{g()},[t]);let g=async()=>{c(!0);try{await new Promise(e=>setTimeout(e,1e3));let e=[{id:"booking_123456789",spotId:"spot_1",spotLocation:"123 Main St, San Francisco, CA",date:new Date().toISOString(),startTime:"10:00",endTime:"14:00",totalCost:"15.00",status:"confirmed",signature:"0x789...signature",signerAddress:t||"0x123...user",transactionHash:"0xabc...tx"},{id:"booking_987654321",spotId:"spot_2",spotLocation:"456 Market St, San Francisco, CA",date:new Date(Date.now()-864e5).toISOString(),startTime:"09:00",endTime:"11:00",totalCost:"10.00",status:"completed",signature:"0x456...signature",signerAddress:t||"0x123...user",transactionHash:"0xdef...tx"}];r(e)}catch(e){console.error("Failed to fetch bookings:",e)}finally{c(!1)}},h=s.filter(e=>{if("all"!==d&&e.status!==d)return!1;if(x){let t=x.toLowerCase();return e.spotLocation.toLowerCase().includes(t)||e.id.toLowerCase().includes(t)}return!0});return i?(0,n.jsx)("div",{className:"text-center py-12",children:"Loading bookings..."}):(0,n.jsxs)("div",{children:[(0,n.jsx)(o,{filter:d,onFilterChange:u,searchQuery:x,onSearchChange:m}),0===h.length?(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"No bookings found"}),(0,n.jsx)("p",{className:"text-sm text-gray-500",children:"all"===d?"You haven't made any bookings yet.":"No ".concat(d," bookings found.")})]}):(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:h.map(e=>(0,n.jsx)(l,{booking:e},e.id))})]})}function d(){let[e,t]=(0,a.useState)(!1),[s,i]=(0,a.useState)(null);return e?(0,n.jsx)("main",{className:"min-h-screen p-8 bg-gray-50",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,n.jsx)("h1",{className:"text-4xl font-bold mb-6",children:"Booking History"}),(0,n.jsx)(c,{userAddress:s})]})}):(0,n.jsx)("main",{className:"min-h-screen p-8 bg-gray-50",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,n.jsx)("h1",{className:"text-4xl font-bold mb-4",children:"Booking History"}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[(0,n.jsx)("p",{className:"text-lg text-gray-600 mb-6",children:"Please connect your wallet to view your booking history"}),(0,n.jsx)(r.Z,{onConnect:e=>{i(e),t(!0)}})]})]})})}},45562:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var n=s(57437);function a(e){let{onConnect:t}=e,s=async()=>{t("0x1234567890123456789012345678901234567890")};return(0,n.jsx)("button",{onClick:s,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Connect Wallet"})}},72081:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var n=s(57437),a=s(2265),r=s(35398),i=s(41960);function l(e){let{bookingId:t,spotId:s,spotLocation:l,signature:o,signerAddress:c,timestamp:d,onSave:u}=e,[x,m]=(0,a.useState)(!1),g=(0,a.useMemo)(()=>(0,i.CS)(t,s,l,o,c,d),[t,s,l,o,c,d]);return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 md:p-8 text-center max-w-sm mx-auto w-full",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Your Booking QR Code"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Show this QR code at the parking location for access"}),(0,n.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 md:p-6 inline-block mb-6 w-full flex justify-center",children:(0,n.jsx)("div",{className:"bg-white p-4 rounded-lg inline-block border-2 border-gray-300",children:(0,n.jsx)(r.ZP,{id:"qr-code-canvas",value:g,size:200,level:"H",includeMargin:!0,className:"w-full h-auto"})})}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,n.jsxs)("p",{children:["Booking ID: ",(0,n.jsx)("span",{className:"font-mono font-medium break-all",children:t})]}),o&&(0,n.jsxs)("p",{className:"mt-2 text-xs text-green-600 flex items-center justify-center gap-1",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Digitally Signed"]})]}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center pt-4",children:[(0,n.jsx)("button",{onClick:()=>{m(!0);let e=document.getElementById("qr-code-canvas");if(e){let s=e.toDataURL("image/png"),n=document.createElement("a");n.download="booking-".concat(t,"-qr.png"),n.href=s,n.click()}m(!1),u&&u()},disabled:x,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors w-full sm:w-auto",children:x?"Downloading...":"Save QR Code"}),(0,n.jsx)("button",{onClick:()=>window.print(),className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors w-full sm:w-auto",children:"Print"})]})]})]})}},41960:function(e,t,s){"use strict";s.d(t,{CS:function(){return a},hV:function(){return r},yR:function(){return i}});var n=s(48790);function a(e,t,s,n,a,r){return JSON.stringify({bookingId:e,spotId:t,location:s,timestamp:r||Date.now(),type:"parking_access",signature:n,signerAddress:a})}function r(e){try{let t=JSON.parse(e);if(!t.bookingId||!t.spotId||!t.type)return null;return t}catch(e){return null}}async function i(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:48;if(Date.now()-e.timestamp>36e5*s)return{valid:!1,error:"QR code expired"};if(e.signature&&t){var a,r;if(!e.signerAddress||e.signerAddress.toLowerCase()!==t.toLowerCase())return{valid:!1,error:"Signer address mismatch"};let s=(a=e.bookingId,r=e.timestamp,"Access Request for Booking: ".concat(a,"\nTimestamp: ").concat(r));try{if(!await (0,n.n)({address:t,message:s,signature:e.signature}))return{valid:!1,error:"Invalid signature"}}catch(e){return{valid:!1,error:"Signature verification failed"}}}else if(t)return{valid:!1,error:"Missing signature"};return{valid:!0}}}},function(e){e.O(0,[9696,3676,2971,2117,1744],function(){return e(e.s=82506)}),_N_E=e.O()}]);