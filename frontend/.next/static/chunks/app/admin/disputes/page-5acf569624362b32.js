(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1435],{37383:function(e,t,s){Promise.resolve().then(s.bind(s,38690))},38690:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var n=s(57437),i=s(2265),r=s(21843),d=s(80014),a=s(80432),o=s(8517),l=s(54506),c=s(33145);function u(e){let{evidence:t}=e,s=t.evidenceHash.startsWith("0x")?null:(0,o.k8)(t.evidenceHash),i=2===t.evidenceType,r=3===t.evidenceType;return(0,n.jsxs)("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-semibold text-gray-800",children:(0,o.gJ)(t.evidenceType)}),(0,n.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Submitted by ",t.submittedBy.slice(0,6),"...",t.submittedBy.slice(-4)]})]}),(0,n.jsx)("span",{className:"text-xs text-gray-500",children:(0,l.Z)(new Date(1e3*Number(t.timestamp)),{addSuffix:!0})})]}),t.description&&(0,n.jsx)("p",{className:"text-gray-700 mb-3",children:t.description}),s&&(0,n.jsxs)("div",{className:"mt-4",children:[i&&(0,n.jsx)("div",{className:"relative w-full h-64 bg-gray-100 rounded-lg overflow-hidden",children:(0,n.jsx)(c.default,{src:s,alt:"Evidence",fill:!0,className:"object-contain",onError:e=>{e.target.style.display="none"}})}),r&&(0,n.jsx)("video",{src:s,controls:!0,className:"w-full rounded-lg",children:"Your browser does not support the video tag."}),!i&&!r&&(0,n.jsxs)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:["View Evidence",(0,n.jsx)("svg",{className:"ml-2 w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]}),(0,n.jsxs)("div",{className:"mt-3 text-xs text-gray-500",children:["Evidence ID: ",t.evidenceId.toString(),t.evidenceHash&&(0,n.jsxs)("span",{className:"ml-2 font-mono",children:["Hash: ",t.evidenceHash.slice(0,16),"..."]})]})]})}var m=s(2398);function x(e){let{disputeId:t}=e,{address:s}=(0,r.R)(),{dispute:o,isLoading:l}=(0,d.$I)(t),{evidence:c,isLoading:x}=(0,d.bC)(t),{votes:p,isLoading:g}=(0,d.Cz)(t),{resolveDisputeManually:h,submitVote:b,hash:v}=(0,d.nz)(),[f,y]=(0,i.useState)(!0),[j,N]=(0,i.useState)(100),[I,w]=(0,i.useState)(""),[k,D]=(0,i.useState)(!1),{isLoading:T,isSuccess:C}=(0,m.A)({hash:v}),E=async()=>{if(o&&!k){D(!0);try{await h(t,f,BigInt(j))}catch(e){console.error("Resolution error:",e),D(!1)}}},S=async()=>{if(!I.trim()){alert("Please provide a justification for your vote");return}try{await b(t,f,BigInt(j),I)}catch(e){console.error("Vote error:",e)}};if(l||!o)return(0,n.jsx)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:(0,n.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,n.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/4"}),(0,n.jsx)("div",{className:"h-32 bg-gray-200 rounded"})]})});if(o.isResolved)return(0,n.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Dispute #",o.disputeId.toString()]}),(0,n.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,n.jsx)("p",{className:"text-lg font-semibold",children:"Status: Resolved"}),(0,n.jsxs)("p",{className:"text-gray-700 mt-2",children:["Refund: ",o.refundApproved?"".concat(Number(o.refundPercentage),"% approved"):"Denied"]}),(0,n.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Resolved by: ",o.resolvedBy.slice(0,6),"...",o.resolvedBy.slice(-4)]})]})]});let P=o.resolutionType===a.Jm.PendingVote;return(0,n.jsx)("div",{className:"space-y-6",children:(0,n.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Dispute #",o.disputeId.toString()]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,n.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Booking ID"}),(0,n.jsx)("p",{className:"text-lg font-semibold",children:o.bookingId.toString()})]}),(0,n.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Escrow ID"}),(0,n.jsx)("p",{className:"text-lg font-semibold",children:o.escrowId.toString()})]})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Reason"}),(0,n.jsx)("p",{className:"text-gray-700 p-4 bg-gray-50 rounded-lg",children:o.reason})]}),c&&c.length>0&&(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Evidence"}),(0,n.jsx)("div",{className:"space-y-4",children:c.map(e=>(0,n.jsx)(u,{evidence:e},e.evidenceId.toString()))})]}),P&&p&&p.length>0&&(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:["Votes (",p.length,")"]}),(0,n.jsx)("div",{className:"space-y-2",children:p.map((e,t)=>(0,n.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"font-medium",children:[e.voter.slice(0,6),"...",e.voter.slice(-4)]}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.justification})]}),(0,n.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(e.supportsRefund?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.supportsRefund?"Refund":"Deny"})]})},t))})]}),P?(0,n.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Submit Vote"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{children:(0,n.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:f,onChange:e=>y(e.target.checked),className:"rounded"}),(0,n.jsx)("span",{children:"Support refund"})]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refund Percentage (if approved)"}),(0,n.jsx)("input",{type:"number",min:"0",max:"100",value:j,onChange:e=>N(Number(e.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Justification *"}),(0,n.jsx)("textarea",{value:I,onChange:e=>w(e.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg",placeholder:"Explain your vote..."})]}),(0,n.jsx)("button",{onClick:S,disabled:T||!I.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400",children:T?"Submitting...":"Submit Vote"})]})]}):(0,n.jsxs)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Manual Resolution"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{children:(0,n.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:f,onChange:e=>y(e.target.checked),className:"rounded"}),(0,n.jsx)("span",{children:"Approve refund"})]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refund Percentage (0-100)"}),(0,n.jsx)("input",{type:"number",min:"0",max:"100",value:j,onChange:e=>N(Number(e.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),(0,n.jsx)("button",{onClick:E,disabled:k||T,className:"px-6 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 disabled:bg-gray-400",children:k||T?"Resolving...":"Resolve Dispute"})]})]})]})})}var p=s(89416),g=s(44005);function h(){let{address:e,isConnected:t}=(0,r.R)(),s=(0,g.x)(),[d,o]=(0,i.useState)(""),[l,c]=(0,i.useState)(null),u=44787===s?a.$Y.alfajores:a.$Y.celo,{data:m}=(0,p.u)({address:u,abi:a.aT,functionName:"moderators",args:e?[e]:void 0,query:{enabled:!!e&&!!u}});return t?!1===m?(0,n.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,n.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,n.jsxs)("div",{className:"p-6 bg-red-50 border border-red-200 rounded-lg text-center",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Access Denied"}),(0,n.jsx)("p",{className:"text-red-700",children:"You are not authorized to access this admin panel."})]})})}):(0,n.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Admin Dispute Panel"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Review and resolve disputes"})]}),(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsx)("input",{type:"number",placeholder:"Enter Dispute ID",value:d,onChange:e=>o(e.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg"}),(0,n.jsx)("button",{onClick:()=>{d&&c(BigInt(d))},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Load Dispute"})]})}),l&&(0,n.jsx)(x,{disputeId:l}),!l&&(0,n.jsx)("div",{className:"p-6 bg-gray-50 border border-gray-200 rounded-lg text-center",children:(0,n.jsx)("p",{className:"text-gray-600",children:"Enter a dispute ID to view details"})})]})}):(0,n.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,n.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,n.jsxs)("div",{className:"p-6 bg-yellow-50 border border-yellow-200 rounded-lg text-center",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-yellow-800 mb-2",children:"Wallet Not Connected"}),(0,n.jsx)("p",{className:"text-yellow-700",children:"Please connect your wallet to access the admin panel."})]})})})}},80432:function(e,t,s){"use strict";s.d(t,{$Y:function(){return a},Jm:function(){return i},aT:function(){return d}});var n,i,r=s(40257);let d=["event DisputeFiled(uint256 indexed disputeId, uint256 indexed escrowId, uint256 indexed bookingId, address filedBy, address opposingParty, string reason, uint8 resolutionType)","event EvidenceSubmitted(uint256 indexed evidenceId, uint256 indexed disputeId, address submittedBy, uint8 evidenceType, bytes evidenceHash)","event CheckInRecorded(uint256 indexed bookingId, uint256 checkInTime, address verifiedBy)","event CheckOutRecorded(uint256 indexed bookingId, uint256 checkOutTime, address verifiedBy)","event AutomatedResolution(uint256 indexed disputeId, bool refundApproved, uint256 refundPercentage, string reason)","event VoteSubmitted(uint256 indexed disputeId, address indexed voter, bool supportsRefund, uint256 weight)","event DisputeResolved(uint256 indexed disputeId, address resolvedBy, bool refundApproved, uint256 refundPercentage, uint8 resolutionType)","function fileDispute(uint256 escrowId, uint256 bookingId, string memory reason, bytes memory evidenceHash, uint8 evidenceType) external returns (uint256)","function submitEvidence(uint256 disputeId, uint8 evidenceType, bytes memory evidenceHash, string memory description) external","function recordCheckIn(uint256 bookingId, uint256 checkInTime) external","function recordCheckOut(uint256 bookingId, uint256 checkOutTime) external","function submitVote(uint256 disputeId, bool supportsRefund, uint256 refundPercentage, string memory justification) external","function resolveDisputeManually(uint256 disputeId, bool refundApproved, uint256 refundPercentage) external","function getDispute(uint256 disputeId) external view returns (tuple(uint256 disputeId, uint256 escrowId, uint256 bookingId, address filedBy, address opposingParty, string reason, bytes primaryEvidenceHash, uint256 filedAt, uint8 resolutionType, bool isResolved, address resolvedBy, uint256 resolvedAt, bool refundApproved, uint256 refundPercentage))","function getDisputeEvidence(uint256 disputeId) external view returns (tuple(uint256 evidenceId, uint256 disputeId, address submittedBy, uint8 evidenceType, bytes evidenceHash, uint256 timestamp, string description)[])","function getCheckInData(uint256 bookingId) external view returns (tuple(uint256 bookingId, uint256 checkInTime, uint256 checkOutTime, bool checkedIn, bool checkedOut, address verifiedBy))","function getDisputeVotes(uint256 disputeId) external view returns (tuple(address voter, bool supportsRefund, uint256 weight, uint256 timestamp, string justification)[])","function getDisputeByEscrowId(uint256 escrowId) external view returns (tuple(uint256 disputeId, uint256 escrowId, uint256 bookingId, address filedBy, address opposingParty, string reason, bytes primaryEvidenceHash, uint256 filedAt, uint8 resolutionType, bool isResolved, address resolvedBy, uint256 resolvedAt, bool refundApproved, uint256 refundPercentage))"],a={alfajores:r.env.NEXT_PUBLIC_DISPUTE_RESOLUTION_ADDRESS_ALFAJORES||"",celo:r.env.NEXT_PUBLIC_DISPUTE_RESOLUTION_ADDRESS_CELO||""};(n=i||(i={}))[n.Automated=0]="Automated",n[n.PendingVote=1]="PendingVote",n[n.Manual=2]="Manual"},80014:function(e,t,s){"use strict";s.d(t,{$I:function(){return l},Cz:function(){return u},bC:function(){return c},nz:function(){return o}});var n=s(21843),i=s(6115),r=s(89416),d=s(80432),a=s(44005);function o(){let{address:e}=(0,n.R)(),t=(0,a.x)(),{writeContract:s,data:r,isPending:o,error:l}=(0,i.S)(),c=44787===t?d.$Y.alfajores:d.$Y.celo;return{fileDispute:async(e,t,n,i,r)=>s({address:c,abi:d.aT,functionName:"fileDispute",args:[e,t,n,i,r]}),submitEvidence:async(e,t,n,i)=>s({address:c,abi:d.aT,functionName:"submitEvidence",args:[e,t,n,i]}),recordCheckIn:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BigInt(Math.floor(Date.now()/1e3));return s({address:c,abi:d.aT,functionName:"recordCheckIn",args:[e,t]})},recordCheckOut:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BigInt(Math.floor(Date.now()/1e3));return s({address:c,abi:d.aT,functionName:"recordCheckOut",args:[e,t]})},submitVote:async(e,t,n,i)=>s({address:c,abi:d.aT,functionName:"submitVote",args:[e,t,n,i]}),resolveDisputeManually:async(e,t,n)=>s({address:c,abi:d.aT,functionName:"resolveDisputeManually",args:[e,t,n]}),hash:r,isPending:o,error:l}}function l(e){let t=44787===(0,a.x)()?d.$Y.alfajores:d.$Y.celo,{data:s,isLoading:n,error:i}=(0,r.u)({address:t,abi:d.aT,functionName:"getDispute",args:e?[e]:void 0,query:{enabled:!!e}});return{dispute:s,isLoading:n,error:i}}function c(e){let t=44787===(0,a.x)()?d.$Y.alfajores:d.$Y.celo,{data:s,isLoading:n,error:i}=(0,r.u)({address:t,abi:d.aT,functionName:"getDisputeEvidence",args:e?[e]:void 0,query:{enabled:!!e}});return{evidence:s,isLoading:n,error:i}}function u(e){let t=44787===(0,a.x)()?d.$Y.alfajores:d.$Y.celo,{data:s,isLoading:n,error:i}=(0,r.u)({address:t,abi:d.aT,functionName:"getDisputeVotes",args:e?[e]:void 0,query:{enabled:!!e}});return{votes:s,isLoading:n,error:i}}},8517:function(e,t,s){"use strict";s.d(t,{O_:function(){return a},VO:function(){return o},gJ:function(){return u},k8:function(){return l},kq:function(){return i},mC:function(){return c}});var n,i,r=s(82957).lW,d=s(40257);async function a(e,t){let s=new FormData;s.append("file",e);try{let e=await fetch("/api/ipfs/upload",{method:"POST",body:s});if(!e.ok)throw Error("Failed to upload to IPFS");return(await e.json()).hash}catch(e){throw console.error("IPFS upload error:",e),e}}function o(e){return"0x"+r.from(e).toString("hex").slice(0,64)}function l(e){let t=d.env.NEXT_PUBLIC_IPFS_GATEWAY||"https://ipfs.io/ipfs/";return"".concat(t).concat(e)}function c(e,t,s){if(!s||0===s.trim().length)return{valid:!1,error:"Evidence description is required"};if(2===e||3===e||4===e){if(!t)return{valid:!1,error:"File is required for this evidence type"};if(t.size>10485760)return{valid:!1,error:"File size exceeds 10MB limit"};if(2===e&&t.type.startsWith("image/")&&!["image/jpeg","image/png","image/webp","image/gif"].includes(t.type))return{valid:!1,error:"Invalid image format. Allowed: JPEG, PNG, WebP, GIF"};if(3===e&&t.type.startsWith("video/")&&!["video/mp4","video/webm","video/quicktime"].includes(t.type))return{valid:!1,error:"Invalid video format. Allowed: MP4, WebM, QuickTime"}}return{valid:!0}}function u(e){return({0:"Check-in Timestamp",1:"Check-out Timestamp",2:"Image",3:"Video",4:"Document",5:"Location Data",6:"Other"})[e]||"Unknown"}(n=i||(i={}))[n.CheckInTimestamp=0]="CheckInTimestamp",n[n.CheckOutTimestamp=1]="CheckOutTimestamp",n[n.Image=2]="Image",n[n.Video=3]="Video",n[n.Document=4]="Document",n[n.LocationData=5]="LocationData",n[n.Other=6]="Other"}},function(e){e.O(0,[9696,58,642,9334,7846,4506,249,2971,2117,1744],function(){return e(e.s=37383)}),_N_E=e.O()}]);