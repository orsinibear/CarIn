(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8568],{3801:function(e,s,t){Promise.resolve().then(t.bind(t,8843))},8843:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return u}});var r=t(57437),a=t(2265),n=t(35475),l=t(45562);function i(e){let{spot:s,onSelect:t}=e,[n,l]=(0,a.useState)(null),[i,o]=(0,a.useState)("09:00"),[c,d]=(0,a.useState)("17:00"),m=()=>{if(!i||!c)return 0;let e=parseInt(i.split(":")[0]),s=parseInt(c.split(":")[0]);return(s>e?s-e:24-e+s)||1};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Date *"}),(0,r.jsx)("div",{className:"border border-gray-300 rounded-lg p-4",children:(0,r.jsx)("input",{type:"date",min:new Date().toISOString().split("T")[0],value:n?n.toISOString().split("T")[0]:"",onChange:e=>l(e.target.value?new Date(e.target.value):null),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time *"}),(0,r.jsx)("input",{type:"time",value:i,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time *"}),(0,r.jsx)("input",{type:"time",value:c,onChange:e=>d(e.target.value),min:i,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]})]}),n&&i&&c&&(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Duration"}),(0,r.jsxs)("p",{className:"text-lg font-semibold",children:[m()," hour(s)"]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Estimated Cost"}),(0,r.jsxs)("p",{className:"text-lg font-semibold text-blue-600",children:[(()=>{let e=m();return(parseFloat(s.pricePerHour)*e).toFixed(2)})()," cUSD"]})]})]})}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("button",{onClick:()=>{if(!n){alert("Please select a date");return}t(n,i,c)},disabled:!n||!i||!c,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:"Continue to Summary"})})]})}function o(e){let{spot:s,selectedDate:t,startTime:n,endTime:l,onBack:i,onConfirm:o,userAddress:c}=e,{createBooking:d,loading:m,error:x}=function(){let[e,s]=(0,a.useState)(!1),[t,r]=(0,a.useState)(null);return{createBooking:(0,a.useCallback)(async(e,t)=>{s(!0),r(null);try{await new Promise(e=>setTimeout(e,2e3));let e="booking_".concat(Date.now()),s="0x".concat(Math.random().toString(16).substring(2,66));return{success:!0,bookingId:e,transactionHash:s}}catch(s){let e=s.message||"Failed to create booking";return r(e),{success:!1,error:e}}finally{s(!1)}},[]),loading:e,error:t}}(),[u,g]=(0,a.useState)(!1),h=(()=>{let e=parseInt(n.split(":")[0]),s=parseInt(l.split(":")[0]);return s>e?s-e:24-e+s||1})(),b=parseFloat(s.pricePerHour)*h,p=.05*b,j=b+p,f=async()=>{g(!0);try{let e={spotId:s.id,date:t.toISOString(),startTime:n,endTime:l,hours:h,totalCost:j.toString()};(await d(e,c)).success&&o()}catch(e){console.error("Booking error:",e)}finally{g(!1)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold",children:"Booking Summary"}),(0,r.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Location:"}),(0,r.jsx)("span",{className:"font-medium",children:s.location})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Date:"}),(0,r.jsx)("span",{className:"font-medium",children:t.toLocaleDateString()})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Time:"}),(0,r.jsxs)("span",{className:"font-medium",children:[n," - ",l]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Duration:"}),(0,r.jsxs)("span",{className:"font-medium",children:[h," hour(s)"]})]})]})}),(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsx)("h4",{className:"font-semibold mb-3",children:"Cost Breakdown"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-gray-700",children:[(0,r.jsxs)("span",{children:["Subtotal (",h," hrs \xd7 ",s.pricePerHour," cUSD/hr):"]}),(0,r.jsxs)("span",{children:[b.toFixed(2)," cUSD"]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-gray-700",children:[(0,r.jsx)("span",{children:"Service Fee (5%):"}),(0,r.jsxs)("span",{children:[p.toFixed(2)," cUSD"]})]}),(0,r.jsxs)("div",{className:"border-t pt-2 mt-2 flex justify-between text-lg font-bold",children:[(0,r.jsx)("span",{children:"Total:"}),(0,r.jsxs)("span",{className:"text-blue-600",children:[j.toFixed(2)," cUSD"]})]})]})]}),x&&(0,r.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:x}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{onClick:i,disabled:u||m,className:"flex-1 px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"Back"}),(0,r.jsx)("button",{onClick:f,disabled:u||m,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:u||m?"Processing...":"Confirm Booking"})]})]})}t(21005);var c=t(72081);function d(e){let{bookingId:s,spot:t,signature:a,userAddress:n}=e;return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 text-center",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Booking Confirmed!"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Your parking spot has been successfully booked"})]}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(c.Z,{bookingId:s,spotId:t.id,spotLocation:t.location,signature:a,signerAddress:n})}),(0,r.jsxs)("div",{className:"border-t pt-6 space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Booking ID:"}),(0,r.jsx)("span",{className:"font-medium break-all text-right ml-4",children:s})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Spot Location:"}),(0,r.jsx)("span",{className:"font-medium text-right ml-4",children:t.location})]}),n&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Booked By:"}),(0,r.jsx)("span",{className:"font-medium text-right ml-4 break-all text-xs",children:n})]})]}),(0,r.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 justify-center",children:[(0,r.jsx)("button",{onClick:()=>window.location.href="/bookings",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"View Booking History"}),(0,r.jsx)("button",{onClick:()=>window.print(),className:"px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Save Receipt"})]})]})}function m(e){let{spot:s,userAddress:t}=e,[n,l]=(0,a.useState)("select-time"),[c,m]=(0,a.useState)(null),[x,u]=(0,a.useState)(""),[g,h]=(0,a.useState)(""),[b,p]=(0,a.useState)(null),[j,f]=(0,a.useState)(null),[y,N]=(0,a.useState)(null),v=async()=>{if(!c||!x||!g){N("Please select date and time");return}l("confirming"),N(null);try{await new Promise(e=>setTimeout(e,2e3));let e="booking_".concat(Date.now()),s="0x"+Array.from({length:64},()=>Math.floor(16*Math.random()).toString(16)).join("");p(e),f(s),l("confirmed")}catch(e){N(e.message||"Failed to create booking"),l("summary")}};return"confirmed"===n&&b?(0,r.jsx)(d,{bookingId:b,spot:s,signature:j||void 0,userAddress:t}):(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Book Parking Spot"}),y&&(0,r.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:y}),"select-time"===n&&(0,r.jsx)(i,{spot:s,onSelect:(e,s,t)=>{m(e),u(s),h(t),l("summary")}}),"summary"===n&&c&&(0,r.jsx)(o,{spot:s,selectedDate:c,startTime:x,endTime:g,onBack:()=>{l("select-time"),N(null)},onConfirm:v,userAddress:t}),"confirming"===n&&(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-lg text-gray-600",children:"Processing your booking..."}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Please confirm the transaction in your wallet"})]})]})}function x(e){let{spot:s}=e;return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden mb-6",children:[(0,r.jsx)("div",{className:"w-full h-64 bg-gray-200 flex items-center justify-center",children:s.images&&s.images.length>0?(0,r.jsxs)("span",{className:"text-gray-500",children:["Image: ",s.images[0]]}):(0,r.jsx)("span",{className:"text-gray-400",children:"No image available"})}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-4",children:s.location}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-4xl font-bold text-blue-600",children:s.pricePerHour}),(0,r.jsx)("span",{className:"text-gray-500 ml-2",children:"cUSD/hour"})]}),(0,r.jsx)("span",{className:"px-4 py-2 rounded-full text-sm font-medium ".concat(s.isAvailable?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:s.isAvailable?"Available":"Unavailable"})]}),(0,r.jsx)("p",{className:"text-gray-700 mb-4",children:s.description}),(0,r.jsxs)("div",{className:"border-t pt-4 text-sm text-gray-500",children:[(0,r.jsxs)("p",{children:["Owner: ",s.owner]}),(0,r.jsxs)("p",{children:["Spot ID: #",s.id]})]})]})]})}function u(){let e=(0,n.useParams)().spotId,[s,t]=(0,a.useState)(!1),[i,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[u,g]=(0,a.useState)(!0);(0,a.useEffect)(()=>{h()},[e]);let h=async()=>{g(!0);try{d({id:e,location:"123 Main St, San Francisco, CA",pricePerHour:"2.50",images:["QmExample1","QmExample2"],description:"Convenient street parking near downtown",owner:"0x123...",isAvailable:!0})}catch(e){console.error("Error fetching spot:",e)}finally{g(!1)}};return u?(0,r.jsx)("main",{className:"min-h-screen p-8 bg-gray-50",children:(0,r.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,r.jsx)(BookingLoading,{})})}):error||!c?(0,r.jsx)("main",{className:"min-h-screen p-8 bg-gray-50",children:(0,r.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("p",{className:"text-red-600 mb-2",children:"Error loading spot"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:error||"Spot not found"})]})})}):s?(0,r.jsx)(BookingErrorBoundary,{children:(0,r.jsx)("main",{className:"min-h-screen p-8 bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)(x,{spot:c}),(0,r.jsx)(m,{spot:c,userAddress:i})]})})}):(0,r.jsx)("main",{className:"min-h-screen p-8 bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)(x,{spot:c}),(0,r.jsxs)("div",{className:"mt-8 bg-white rounded-lg shadow p-8 text-center",children:[(0,r.jsx)("p",{className:"text-lg text-gray-600 mb-6",children:"Please connect your wallet to book this parking spot"}),(0,r.jsx)(l.Z,{onConnect:e=>{o(e),t(!0)}})]})]})})}},45562:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});var r=t(57437);function a(e){let{onConnect:s}=e,t=async()=>{s("0x1234567890123456789012345678901234567890")};return(0,r.jsx)("button",{onClick:t,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Connect Wallet"})}},72081:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});var r=t(57437),a=t(2265),n=t(35398),l=t(41960);function i(e){let{bookingId:s,spotId:t,spotLocation:i,signature:o,signerAddress:c,timestamp:d,onSave:m}=e,[x,u]=(0,a.useState)(!1),g=(0,a.useMemo)(()=>(0,l.CS)(s,t,i,o,c,d),[s,t,i,o,c,d]);return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 md:p-8 text-center max-w-sm mx-auto w-full",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Your Booking QR Code"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Show this QR code at the parking location for access"}),(0,r.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 md:p-6 inline-block mb-6 w-full flex justify-center",children:(0,r.jsx)("div",{className:"bg-white p-4 rounded-lg inline-block border-2 border-gray-300",children:(0,r.jsx)(n.ZP,{id:"qr-code-canvas",value:g,size:200,level:"H",includeMargin:!0,className:"w-full h-auto"})})}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,r.jsxs)("p",{children:["Booking ID: ",(0,r.jsx)("span",{className:"font-mono font-medium break-all",children:s})]}),o&&(0,r.jsxs)("p",{className:"mt-2 text-xs text-green-600 flex items-center justify-center gap-1",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Digitally Signed"]})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center pt-4",children:[(0,r.jsx)("button",{onClick:()=>{u(!0);let e=document.getElementById("qr-code-canvas");if(e){let t=e.toDataURL("image/png"),r=document.createElement("a");r.download="booking-".concat(s,"-qr.png"),r.href=t,r.click()}u(!1),m&&m()},disabled:x,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors w-full sm:w-auto",children:x?"Downloading...":"Save QR Code"}),(0,r.jsx)("button",{onClick:()=>window.print(),className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors w-full sm:w-auto",children:"Print"})]})]})]})}},41960:function(e,s,t){"use strict";t.d(s,{CS:function(){return a},hV:function(){return n},yR:function(){return l}});var r=t(48790);function a(e,s,t,r,a,n){return JSON.stringify({bookingId:e,spotId:s,location:t,timestamp:n||Date.now(),type:"parking_access",signature:r,signerAddress:a})}function n(e){try{let s=JSON.parse(e);if(!s.bookingId||!s.spotId||!s.type)return null;return s}catch(e){return null}}async function l(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:48;if(Date.now()-e.timestamp>36e5*t)return{valid:!1,error:"QR code expired"};if(e.signature&&s){var a,n;if(!e.signerAddress||e.signerAddress.toLowerCase()!==s.toLowerCase())return{valid:!1,error:"Signer address mismatch"};let t=(a=e.bookingId,n=e.timestamp,"Access Request for Booking: ".concat(a,"\nTimestamp: ").concat(n));try{if(!await (0,r.n)({address:s,message:t,signature:e.signature}))return{valid:!1,error:"Invalid signature"}}catch(e){return{valid:!1,error:"Signature verification failed"}}}else if(s)return{valid:!1,error:"Missing signature"};return{valid:!0}}},21005:function(){}},function(e){e.O(0,[7360,9696,3676,2971,2117,1744],function(){return e(e.s=3801)}),_N_E=e.O()}]);